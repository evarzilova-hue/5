<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Социален Компас: Робинзон Крузо и AI</title>
    <!-- Зареждане на Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Линк към PWA манифеста -->
    <link rel="manifest" href="manifest.webmanifest">
    <!-- Икони (заместете с генерираните PNGs от SVG) -->
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    <meta name="theme-color" content="#22c55e">
    <style>
        /* Персонализиран стил за по-добро PWA усещане */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0fdf4; /* Light green background */
        }
        .container {
            min-height: 100vh;
        }
        .shaking {
            animation: shake 0.82s cubic-bezier(.36,.07,.19,.97) both;
            transform: translate3d(0, 0, 0);
            backface-visibility: hidden;
            perspective: 1000px;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
    </style>
</head>
<body>

<div class="container mx-auto p-4 flex flex-col items-center">
    
    <!-- Заглавна секция и Ротиращо Мото (Дигитален наръчник на Крузо) -->
    <header class="w-full max-w-md bg-white shadow-xl rounded-xl p-4 mb-4 border-b-4 border-green-500">
        <h1 class="text-2xl font-extrabold text-gray-800 text-center mb-1">Социален Компас</h1>
        <p class="text-sm font-medium text-green-600 text-center mb-3">Робинзон Крузо | Етика & STEM</p>
        <div id="motto-display" class="text-center italic text-sm text-gray-600 h-10 flex items-center justify-center transition duration-500 ease-in-out">
            <!-- Мотото ще се вмъква тук -->
        </div>
    </header>

    <!-- Основно Табло / Таймер -->
    <main class="w-full max-w-md bg-white shadow-2xl rounded-xl p-6 mb-6">
        <h2 class="text-xl font-bold text-gray-700 mb-4 flex items-center justify-between">
            <span class="flex items-center">
                <svg class="w-6 h-6 mr-2 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                Крузо Аларм (Дигитално Време)
            </span>
            <span id="lock-status" class="text-sm font-semibold text-red-500">ОТКЛЮЧЕН</span>
        </h2>
        
        <div class="text-center mb-6">
            <div id="timer-display" class="text-6xl font-mono font-black text-gray-800 bg-gray-100 p-4 rounded-lg shadow-inner">00:00</div>
            <p class="text-xs text-gray-500 mt-1">Праг на Аларма: 50 минути</p>
        </div>

        <!-- Хормонален Баланс -->
        <div class="mb-6 p-4 border rounded-lg bg-yellow-50 border-yellow-200">
            <h3 class="font-bold text-orange-600 mb-2 flex items-center">
                <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                Хормонален Баланс (Симулация)
            </h3>
            <div class="flex justify-between text-sm">
                <p>Кортизол (Стрес): <span id="cortisol-level" class="font-bold text-red-600">0</span></p>
                <p>Ендорфини (Щастие): <span id="endorphin-level" class="font-bold text-green-600">0</span></p>
            </div>
            <div id="hormone-message" class="text-center mt-2 text-xs font-semibold text-blue-600 transition-opacity opacity-0 h-4"></div>
        </div>

        <!-- Контроли -->
        <div class="flex space-x-2">
            <button id="start-btn" onclick="startTimer()" class="flex-1 py-3 bg-green-500 hover:bg-green-600 text-white font-bold rounded-xl shadow-lg transition duration-150 active:scale-95">
                СТАРТ
            </button>
            <button id="mission-btn" onclick="openMissionPanel()" class="flex-1 py-3 bg-indigo-500 hover:bg-indigo-600 text-white font-bold rounded-xl shadow-lg transition duration-150 active:scale-95" disabled>
                ГЕНЕРИРАЙ МИСИЯ (ФВС)
            </button>
        </div>
    </main>

    <!-- Модален Панел за ФВС Мисия -->
    <div id="mission-panel" class="fixed inset-0 bg-black bg-opacity-75 hidden z-50 p-4 items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl max-w-md w-full p-6 transform transition-all">
            <h3 class="text-2xl font-bold text-indigo-700 mb-4">SURVIVAL MISSION (ФВС)</h3>
            <div class="mb-4 p-4 bg-indigo-100 border-l-4 border-indigo-500 rounded-lg">
                <p id="mission-title" class="text-lg font-semibold text-indigo-800 mb-2">Мисия:</p>
                <p id="mission-instruction" class="text-gray-700 text-sm"></p>
            </div>
            
            <div class="flex space-x-3 mt-6">
                <button onclick="confirmMission(true)" class="flex-1 py-3 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg transition duration-150 active:scale-95">
                    ИЗПЪЛНЕНО! (Коригирай Баланса)
                </button>
                <button onclick="confirmMission(false)" class="flex-1 py-3 bg-red-500 hover:bg-red-600 text-white font-bold rounded-lg transition duration-150 active:scale-95">
                    ОТКАЗ (Активирай Етичен Филтър)
                </button>
            </div>
        </div>
    </div>

    <!-- Модален Панел за Етичен Филтър -->
    <div id="ethical-filter-panel" class="fixed inset-0 bg-black bg-opacity-75 hidden z-50 p-4 items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl max-w-lg w-full p-6 transform transition-all">
            <h3 class="text-2xl font-bold text-red-700 mb-4 flex items-center">
                <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                Етичен Филтър: Казус "Адам Рейн"
            </h3>
            <p class="text-sm text-gray-600 mb-4">Моля, отговорете честно на следните въпроси (Да/Не). Две или повече отговора "Да" активират Критично Насочване.</p>
            
            <div id="ethical-questions" class="space-y-4">
                <!-- Въпросите се генерират тук -->
            </div>
            
            <button onclick="submitEthicalFilter()" class="w-full mt-6 py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-xl shadow-lg transition duration-150 active:scale-95">
                ПОТВЪРДИ ОТГОВОРИ
            </button>
        </div>
    </div>

    <!-- Модален Панел за Кризисни Контакти -->
    <div id="crisis-contacts-panel" class="fixed inset-0 bg-black bg-opacity-75 hidden z-50 p-4 items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl max-w-md w-full p-6 transform transition-all text-center border-t-8 border-red-500">
            <h3 class="text-2xl font-bold text-red-600 mb-4 flex items-center justify-center">
                <svg class="w-8 h-8 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.414-1.414L11 9.586V6z" clip-rule="evenodd"></path></svg>
                Критично Насочване (КРИЗА)
            </h3>
            <p class="text-lg text-gray-700 mb-4">Потърси помощ. Истинската връзка е спасение.</p>
            
            <div id="crisis-contacts" class="space-y-3 bg-red-50 p-4 rounded-lg border border-red-200">
                <!-- Контактите се вмъкват тук -->
            </div>
            
            <button onclick="closeCrisisPanel()" class="w-full mt-6 py-3 bg-gray-400 hover:bg-gray-500 text-white font-bold rounded-xl transition duration-150 active:scale-95">
                ЗАТВОРИ
            </button>
        </div>
    </div>

</div>

<script>
    // --- КОНФИГУРАЦИЯ НА ПРИЛОЖЕНИЕТО (Извлечена от документа) ---
    const CONFIG = {
        // Секция I: Хуманитарен анализ (Мотота)
        MOTTOES: [
            "Самодисциплината крепи духа, редът побеждава отчаянието.",
            "Колкото повече учи изкуственият интелект, толкова по-малко учим ние.",
            "Истинската стойност е в ръката, която държиш, не в екрана, който гледаш.",
            "Трудът възражда тялото и духа.",
            "Вярата дава смисъл, надеждата води към спасение."
        ],
        // Секция II: STEM и Социално проучване
        ALARM_THRESHOLD_MINUTES: 50, // Праг на "Крузо аларм" (минути)
        CORTISOL_CORRECTION: -15,   // Корекция на кортизол (отрицателно число)
        ENDORPHIN_CORRECTION: +20,  // Корекция на ендорфини (положително число)
        CORTISOL_TICK_INCREASE: 5,  // Увеличение на кортизол на всеки 5 минути
        // Секция III: ФВС Мисии
        MISSIONS: [
            { title: "Планински катерач", instruction: "Подпрян на лакти и пръсти, движи коленете към гърдите бързо, като катериш невидима планина, за 50 секунди. Усети мощта на всеки мускул!" },
            { title: "Мълниеносни клекове", instruction: "Направи колкото се може повече клека за 40 секунди, като се стремиш към правилна стойка и контролирано движение. Всеки клек носи сила!" },
            { title: "Скокливи джунгли", instruction: "Скочи на място с разтваряне и свиване на ръце (jumping jacks) за 45 секунди. Усети как сърцето ти започва да бие по-бързо и енергията ти се повишава!" },
            { title: "Супер скоростна планка", instruction: "Застани в позиция планка на лакти и редувай повдигане на колене към гърдите бързо за 60 секунди. Изпитай как коремът и ръцете ти работят като една мощна машина!" }
        ],
        // Секция IV: Етичен филтър
        ETHICAL_QUESTIONS: [
            { text: "Предпочитате ли да общувате с изкуствения интелект вместо с реални хора?", id: "q1" },
            { text: "Използвате ли екрана като бягство от проблемите си или от трудна ситуация?", id: "q2" },
            { text: "Случва ли ви се да пропускате сън, хранене или почивка, за да продължите да използвате телефона, компютъра или друг екран?", id: "q3" }
        ],
        // Допълнителни данни: Кризисни контакти
        CRISIS_CONTACTS: [
            { name: "Национална линия за подкрепа", contact: "116 111" },
            { name: "Разговор с консултант", contact: "0800 1 86 76" }
        ]
    };

    // --- СЪСТОЯНИЕ НА ПРИЛОЖЕНИЕТО (STATE) ---
    let timerInterval = null;
    let hormoneInterval = null;
    let secondsElapsed = 0;
    let isAlarmTriggered = false;
    let cortisolLevel = 0;
    let endorphinLevel = 0;
    
    // --- ЕЛЕМЕНТИ НА DOM ---
    const timerDisplay = document.getElementById('timer-display');
    const lockStatus = document.getElementById('lock-status');
    const startBtn = document.getElementById('start-btn');
    const missionBtn = document.getElementById('mission-btn');
    const missionPanel = document.getElementById('mission-panel');
    const ethicalFilterPanel = document.getElementById('ethical-filter-panel');
    const crisisContactsPanel = document.getElementById('crisis-contacts-panel');
    const mottoDisplay = document.getElementById('motto-display');
    const cortisolDisplay = document.getElementById('cortisol-level');
    const endorphinDisplay = document.getElementById('endorphin-level');
    const hormoneMessage = document.getElementById('hormone-message');
    const ethicalQuestionsContainer = document.getElementById('ethical-questions');

    // --- ФУНКЦИИ ЗА ПОМОЩ И UI ---
    
    // А. Хуманитарен анализ: Ротация на Мотота
    function startMottoRotation() {
        let mottoIndex = 0;
        const rotateMotto = () => {
            mottoDisplay.style.opacity = '0';
            setTimeout(() => {
                mottoDisplay.textContent = CONFIG.MOTTOES[mottoIndex];
                mottoDisplay.style.opacity = '1';
                mottoIndex = (mottoIndex + 1) % CONFIG.MOTTOES.length;
            }, 500); // Изчакване на избледняване
        };
        
        rotateMotto(); // Покажи първото мото веднага
        setInterval(rotateMotto, 7000); // Сменяй мотото на всеки 7 секунди
    }

    // Актуализиране на дисплея на таймера
    function updateTimerDisplay() {
        const totalMinutes = Math.floor(secondsElapsed / 60);
        const secs = secondsElapsed % 60;
        const formattedMinutes = String(totalMinutes).padStart(2, '0');
        const formattedSeconds = String(secs).padStart(2, '0');
        timerDisplay.textContent = `${formattedMinutes}:${formattedSeconds}`;
    }

    // Актуализиране на дисплея на хормоните
    function updateHormoneDisplay(message = null) {
        cortisolDisplay.textContent = cortisolLevel;
        endorphinDisplay.textContent = endorphinLevel;
        cortisolDisplay.className = `font-bold ${cortisolLevel > 0 ? 'text-red-600' : 'text-gray-600'}`;
        endorphinDisplay.className = `font-bold ${endorphinLevel > 0 ? 'text-green-600' : 'text-gray-600'}`;

        if (message) {
            hormoneMessage.textContent = message;
            hormoneMessage.style.opacity = '1';
            setTimeout(() => { hormoneMessage.style.opacity = '0'; }, 3000);
        }
    }

    // Генериране на Кризисни контакти в панела
    function generateCrisisContacts() {
        const html = CONFIG.CRISIS_CONTACTS.map(contact => `
            <div class="p-3 bg-red-100 rounded-lg flex justify-between items-center">
                <span class="font-semibold text-red-800">${contact.name}</span>
                <a href="tel:${contact.contact.replace(/\s/g, '')}" class="text-lg font-bold text-red-700 hover:text-red-900 transition duration-150 underline">${contact.contact}</a>
            </div>
        `).join('');
        document.getElementById('crisis-contacts').innerHTML = html;
    }

    // Генериране на въпросите от Етичния филтър
    function generateEthicalQuestions() {
        const html = CONFIG.ETHICAL_QUESTIONS.map(q => `
            <div class="flex flex-col p-3 bg-gray-50 rounded-lg border border-gray-200">
                <label class="text-gray-700 font-medium mb-2">${q.text}</label>
                <div class="flex space-x-4">
                    <label class="inline-flex items-center">
                        <input type="radio" name="ethical_q_${q.id}" value="yes" class="form-radio text-red-500 w-4 h-4">
                        <span class="ml-2 text-sm font-semibold text-red-600">Да</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="radio" name="ethical_q_${q.id}" value="no" checked class="form-radio text-green-500 w-4 h-4">
                        <span class="ml-2 text-sm font-semibold text-green-600">Не</span>
                    </label>
                </div>
            </div>
        `).join('');
        ethicalQuestionsContainer.innerHTML = html;
    }

    // --- ОСНОВНА ЛОГИКА НА ПРИЛОЖЕНИЕТО ---

    // Б. STEM / Крузо аларм: Стартиране на таймера
    function startTimer() {
        if (isAlarmTriggered) return; // Не може да се стартира, ако е заключен

        if (timerInterval) {
            // Пауза
            clearInterval(timerInterval);
            clearInterval(hormoneInterval);
            timerInterval = null;
            hormoneInterval = null;
            startBtn.textContent = 'ПРОДЪЛЖИ';
            startBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
            startBtn.classList.add('bg-green-500', 'hover:bg-green-600');
            timerDisplay.classList.remove('shaking');
            lockStatus.textContent = 'ПАУЗА';
        } else {
            // Старт/Продължение
            startBtn.textContent = 'ПАУЗА';
            startBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
            startBtn.classList.add('bg-red-500', 'hover:bg-red-600');
            lockStatus.textContent = 'РАБОТИ';
            timerDisplay.classList.add('shaking');
            
            // Стартиране на таймера
            timerInterval = setInterval(() => {
                secondsElapsed++;
                updateTimerDisplay();
                
                // Проверка за прага на алармата
                if (secondsElapsed >= CONFIG.ALARM_THRESHOLD_MINUTES * 60 && !isAlarmTriggered) {
                    triggerAlarm();
                }
            }, 1000);

            // Увеличаване на кортизола на всеки 5 минути (300 секунди)
            hormoneInterval = setInterval(() => {
                cortisolLevel += CONFIG.CORTISOL_TICK_INCREASE;
                updateHormoneDisplay(`Кортизол +${CONFIG.CORTISOL_TICK_INCREASE} (Дигитален стрес)`);
            }, 5 * 60 * 1000); // 5 минути
        }
    }

    // Заключване на приложението и изискване на мисия
    function triggerAlarm() {
        clearInterval(timerInterval);
        clearInterval(hormoneInterval);
        timerInterval = null;
        hormoneInterval = null;
        isAlarmTriggered = true;
        
        lockStatus.textContent = 'ЗАКЛЮЧЕН (ИСКА МИСИЯ)';
        lockStatus.classList.add('animate-pulse');
        timerDisplay.classList.remove('shaking');
        
        startBtn.textContent = 'АЛАРМА!';
        startBtn.disabled = true;
        startBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
        startBtn.classList.add('bg-gray-400');
        
        missionBtn.disabled = false;
        missionBtn.classList.remove('bg-gray-400');
        missionBtn.classList.add('bg-indigo-500', 'hover:bg-indigo-600');
        missionBtn.classList.add('shaking');
    }

    // В. ФВС Мисии: Отваряне на панела с мисията
    function openMissionPanel() {
        // Генериране на случайна мисия
        const randomIndex = Math.floor(Math.random() * CONFIG.MISSIONS.length);
        const mission = CONFIG.MISSIONS[randomIndex];
        
        document.getElementById('mission-title').textContent = `${mission.title}:`;
        document.getElementById('mission-instruction').textContent = mission.instruction;
        
        missionPanel.classList.remove('hidden');
        missionPanel.classList.add('flex');
    }

    // Потвърждение за изпълнение на мисията
    function confirmMission(isCompleted) {
        missionPanel.classList.remove('flex');
        missionPanel.classList.add('hidden');
        missionBtn.classList.remove('shaking');

        if (isCompleted) {
            // Успешно изпълнена мисия: Корекция на хормоните
            cortisolLevel += CONFIG.CORTISOL_CORRECTION; // -15
            endorphinLevel += CONFIG.ENDORPHIN_CORRECTION; // +20
            
            updateHormoneDisplay(`УСПЕХ! Кортизол ${CONFIG.CORTISOL_CORRECTION}, Ендорфини +${CONFIG.ENDORPHIN_CORRECTION}`);

            // Нулиране на таймера и отключване
            secondsElapsed = 0;
            isAlarmTriggered = false;
            updateTimerDisplay();
            
            lockStatus.textContent = 'ОТКЛЮЧЕН';
            lockStatus.classList.remove('animate-pulse');
            
            startBtn.disabled = false;
            startBtn.textContent = 'СТАРТ';
            startBtn.classList.remove('bg-gray-400');
            startBtn.classList.add('bg-green-500', 'hover:bg-green-600');

            missionBtn.disabled = true;
            missionBtn.classList.remove('bg-indigo-500', 'hover:bg-indigo-600');
            missionBtn.classList.add('bg-gray-400');

        } else {
            // Г. Етичен филтър: Отказ от мисия - Активиране на Етичния филтър
            openEthicalFilter();
        }
    }

    // Отваряне на Етичния филтър
    function openEthicalFilter() {
        generateEthicalQuestions();
        ethicalFilterPanel.classList.remove('hidden');
        ethicalFilterPanel.classList.add('flex');
    }

    // Г. Етичен филтър: Подаване на отговори и Критично насочване
    function submitEthicalFilter() {
        let yesCount = 0;
        
        CONFIG.ETHICAL_QUESTIONS.forEach(q => {
            const radios = document.getElementsByName(`ethical_q_${q.id}`);
            for (const radio of radios) {
                if (radio.checked && radio.value === 'yes') {
                    yesCount++;
                }
            }
        });

        ethicalFilterPanel.classList.remove('flex');
        ethicalFilterPanel.classList.add('hidden');

        // Логика: 2 или повече "Да" отговора = Критично Насочване
        if (yesCount >= 2) {
            openCrisisContacts();
        } else {
            // Ако рискът е нисък, просто отключи, но запази хормоните
            secondsElapsed = 0;
            isAlarmTriggered = false;
            updateTimerDisplay();
            
            lockStatus.textContent = 'ОТКЛЮЧЕН (ОЦЕНЕН РИСК)';
            lockStatus.classList.remove('animate-pulse');
            
            startBtn.disabled = false;
            startBtn.textContent = 'СТАРТ';
            startBtn.classList.remove('bg-gray-400');
            startBtn.classList.add('bg-green-500', 'hover:bg-green-600');

            missionBtn.disabled = true;
            missionBtn.classList.remove('bg-indigo-500', 'hover:bg-indigo-600');
            missionBtn.classList.add('bg-gray-400');
        }
    }
    
    // Показване на Кризисните контакти
    function openCrisisContacts() {
        crisisContactsPanel.classList.remove('hidden');
        crisisContactsPanel.classList.add('flex');
    }
    
    // Затваряне на Кризисния панел
    function closeCrisisPanel() {
        crisisContactsPanel.classList.remove('flex');
        crisisContactsPanel.classList.add('hidden');
        // Потребителят е преминал през критично насочване, приложението се отключва.
        secondsElapsed = 0;
        isAlarmTriggered = false;
        updateTimerDisplay();
        
        lockStatus.textContent = 'ОТКЛЮЧЕН (ПРЕГЛЕД НА КОНТАКТИ)';
        lockStatus.classList.remove('animate-pulse');
        
        startBtn.disabled = false;
        startBtn.textContent = 'СТАРТ';
        startBtn.classList.remove('bg-gray-400');
        startBtn.classList.add('bg-green-500', 'hover:bg-green-600');

        missionBtn.disabled = true;
        missionBtn.classList.remove('bg-indigo-500', 'hover:bg-indigo-600');
        missionBtn.classList.add('bg-gray-400');
    }

    // --- ИНИЦИАЛИЗАЦИЯ ---
    window.onload = function() {
        startMottoRotation();
        updateHormoneDisplay();
        generateCrisisContacts(); // Генерираме контактите веднъж при стартиране
    };

</script>

</body>
</html>
